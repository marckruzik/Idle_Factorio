@using BlazorApp.Shared.Models
@using NS_Game_Engine
@implements IDisposable

@code{
    
    [Parameter] public Position position { get; set; }


    Manager_Listener manager_listener = new Manager_Listener ();
    
    public bool need_refresh = true;
}




@code {



    protected override void OnInitialized()
    {
        base.OnInitialized ();
        listener_setup ();
        Blazora.Pages.Game_Page.graphical_action += graphical_update;
    }



    public virtual void graphical_update ()
    {
        listener_update ();

        if (this.need_refresh == false)
        {
            return;
        }

        StateHasChanged ();
        this.need_refresh = false;
    }


    public virtual void listener_setup ()
    {

    }



    public void listener_add<T> (Func<T> func)
    {
        this.manager_listener.add (func);
    }

    public void listener_update ()
    {
        bool need_update = this.manager_listener.need_update ();
        if (need_update == true)
        {
            this.need_refresh = true;
        }
    }



    public virtual void Dispose ()
    {
        Blazora.Pages.Game_Page.graphical_action -= graphical_update;
    }
}
