@inherits BGenerator_Component
@using BlazorApp.Shared.Models
@using NS_Manager_Resource
@using NS_Game_Engine

@using Pages

@code{


}



@{ 
    Console.WriteLine ("generate Blazor " + this.id);
}

@for (int i = 0; i < this.recipe.get_component_count (); i++)
{
    Resource_Stack component_stack = this.recipe.mix_component.list_resource_stack[i];

    string resource_name = component_stack.resource_name;

    // Global stock
    <Cellicon picture_filename=@(Resource.from_resource_name_get_resource_filename (component_stack.resource_name))
                position=@(new Position (s * 0, s * i, s, s))
                text_bottom_right=@($"{get_stock_val (resource_name)}")
                />

    
    //int max_indicator = Math.Max (get_stack_max (resource_name), get_loc_min (resource_name));
   

    <Cellicon picture_filename=@(Resource.from_resource_name_get_resource_filename (component_stack.resource_name))
                position=@(new Position (s * 3, s * i, s, s))
                action=@(() =>
                         {
                             Console.WriteLine ($"{component_stack.resource_name}_in_tool_kind");
                             Manager_Resource.resource_transfer (
                                 Game_Engine.self.manager_resource,
                                 this.generator.manager_resource,
                                 component_stack.resource_name,
                                 1);
                         })
                val_authorize=@(action_ready (resource_name))
                text_bottom_right=@($"{get_loc_val (resource_name)}/{get_loc_min (resource_name)}")
                stack_val_current=@(get_loc_quantity (resource_name))
                stack_val_max=@(get_stack_quantity_max (resource_name))
                parent=this
              />

}


@{



}


@code{

    public static BGenerator_Line_Stock line_stock;

    protected override void OnInitialized ()
    {
        this.id = $"Line_Stock [{this.recipe.get_first_result_resource_name ()}]";
        base.OnInitialized ();
        if (get_result_resource_name () == "iron_ore")
        {
            line_stock = this;
        }
    }

    public override void listener_setup ()
    {
        base.listener_setup ();


        foreach (string resource_name in this.recipe.mix_component.get_list_resource_name ())
        {
            listener_add ("BGL loc_quantity", get_loc_quantity (resource_name));
            listener_add ("BGL stock_quantity", get_stock_quantity (resource_name));
            listener_add ("BGL stack_max", get_stack_quantity_max (resource_name));
        }

        listener_add ("BGL tool", get_stack_tool ().observable_quantity);
    }



    public bool action_ready (string resource_name)
    {
        if (get_stock_val (resource_name) == 0)
        {
            return false;
        }

        if (get_loc_val (resource_name) == get_stack_quantity_max (resource_name) &&
            get_stack_quantity_max (resource_name) < get_loc_min (resource_name))
        {
            return false;
        }

        return true;
    }



}

